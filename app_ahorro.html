<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reto 365 - App de Ahorro</title>
    <!-- Bootstrap 5.3.3 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
    <style>
      :root {
        --bs-primary: #c5e861;
        --bs-primary-rgb: 0, 184, 148;
        --bs-background: #effce0;
        --bs-secondary: #1b2020;
        --bs-secondary-rgb: 45, 52, 54;
      }

      body {
        background-color: var(--bs-background);
        font-family: consolas;
      }

      /* pantalla de bienvenida */
      
    .splash-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: var(--bs-primary); /* color primario de Bootstrap */
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 1050;
      color: var(--bs-secondary);
      animation: fadeOut 1s ease-in-out 2s forwards; 
    }

    .splash-screen h1 {
      font-size: 4rem;
      animation: zoomIn 1s ease;
      margin:0;
    }

    .splash-screen .text_numero_inicial{
      font-size: 15rem !important; 
      font-weight: 900 !important;
    } 

    @keyframes zoomIn {
      from {
        opacity: 0;
        transform: scale(0.8);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    @keyframes fadeOut {
      to {
        opacity: 0;
        visibility: hidden;
      }
    }

    .main-content {
      display: none;
    }

    body.loaded .main-content {
      display: block;
      padding: 2rem;
    }

      .app-container {
        max-width: 600px;
        border-radius: 20px;
        padding: 32px;
        overflow: hidden;
        background-color: var(--bs-background);
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
      }

      .header {
        display: flex;
        width: 100%;
        padding: 16px;
        align-items: center;
        gap: 8px;
        margin: 0 0 16px 0;
      }

      .header .avatar {
        width: 80px;
        height: 80px;
        border: solid 2px;
        border-color: darkseagreen;
        border-radius: 50px;
      }

      .header .avatar img {
        width: 100%;
        height: 100%;
        border-radius: 50px;
        object-fit: cover;
        object-position: top;
      }

      .header-text {
        /* background: linear-gradient(135deg, var(--bs-primary), #00d2b5); */
        display: flex;
        flex-direction: column;
      }

      .datos_ahorro{
        display: flex;
        flex-direction: column;
        gap: 32px;
      } 

      .progreso {
        background-color: #c5e861;
        border-radius: 35px;
        padding: 32px;
      }

      .progreso #progressText,
      .progreso #remainingText {
        font-size: 16px;
        font-weight: 600;
      }

      .progress-thin {
        height: 10px;
      }

      .progress-bar {
        background: var(--bs-secondary) !important;
      }

      .ahorro {
        padding: 32px;
        display: flex;
        background-color: var(--bs-secondary);
        border-radius: 35px;
        color: white;
        flex-direction: column;
        gap:8px;
      }

      .ahorro h1 {
        font-size: 48px;
      }

      .ahorro p {
        font-size: 24px;
        color: white;
        margin: 0;
      }

      .ahorro .botones{
        flex-direction: column;
      }

      .botones .boton_primario{
        background-color: var(--bs-primary) !important;
        color: var(--bs-secondary) !important;
        border: none !important;
        border-radius: 35px !important;
        min-height: 50px !important;
        font-weight: 600;
      }

      .botones .boton_secundario{
        color: var(--bs-primary) !important;
        border-color: var(--bs-primary) !important;
        border-radius: 35px !important;
        min-height: 50px !important;
        font-weight: 600;
      }

      .botones .boton_secundario:hover{
        background-color: var(--bs-primary);
        color: var(--bs-secondary) !important;
        border-color: var(--bs-primary) !important;
        border-radius: 35px !important;
        min-height: 50px !important;
      }

      .card-display {
        height: 120px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2.5rem;
        font-weight: 700;
        background-color: #f0f5f5;
      }

      #lastNumber {
        font-size: 24px;
        font-weight: 600;
      }

      /* .slide-action {
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .slide-action:hover {
        background-color: #00a884 !important;
      } */

      .modal-body{
        background-color: var(--bs-secondary);
        color: white;
        max-height: 500px;
        overflow: auto;
      }

      .history-item {
        border-bottom: 1px solid #dee2e6;
        padding: 0.75rem 0;
      }

      .history-item:last-child {
        border-bottom: none;
      }

      .history-modal .modal-header {
        background: var(--bs-secondary);
        color: var(--bs-primary); 
      }

      .area_boton_historial {
        background: var(--bs-secondary);
        padding: 16px;
        text-align: center;
      }

      .area_boton_historial .boton_historial {
        background: var(--bs-primary);
        color: var(--bs-secondary);
        border-radius: 35px !important;
        border: none !important;
        padding: 16px 32px !important;
      }
    </style>
  </head>
  <body class="d-flex justify-content-center align-items-center min-vh-100 p-3">
    <!-- Splash screen -->
  <div class="splash-screen text-center">
    <h1 class="fw-bold">Reto</h1>
    <h1 class="fw-bold text_numero_inicial">365</h1>
    <p class="lead">Tu ahorro diario</p>
  </div>

    <div class="app-container w-100">
      <!-- Header -->
      <div class="header">
        <div class="avatar">
          <img src="img_perfil.png" alt="imagen de perfil">
        </div>
        <div class="header-text">
          <h1 class="h4 mb-1 fw-bold">Bienvenido</h1>
          <p class="small opacity-85 mb-0" id="currentDate">Hoy: 10/5/2025</p>
        </div>
      </div>

      <div class="datos_ahorro">
        <!-- Progreso -->
      <div class="progreso">
        <div class="d-flex justify-content-between mb-2 small">
          <div class="progreso_numero">
            <p class="mb-0">Progreso:</p>
          <span id="progressText">0 de 365 días</span>
        </div>
        <div class="completado">
          <p class="mb-0">Completado:</p>
          <span id="remainingText">Quedan 365</span>
        </div>
        </div>
        <div class="progress progress-thin">
          <div
            id="progressBar"
            class="progress-bar bg-primary"
            role="progressbar"
            style="width: 0%"
          ></div>
        </div>
      </div>

      <!-- Ahorro Total -->
      <div class="ahorro text-start">
        <p>Ahorro Total:</p>
        <h1 id="totalSavings" class="fw-bold mb-3">$0</h1>
        <div class="botones d-flex gap-3">
          <button id="drawCard" class="boton_primario btn btn-primary flex-grow-1 py-2">
            Sacar Tarjeta
          </button>
          <button  id="showHistory"  class="boton_secundario btn btn-outline-primary flex-grow-1 py-2">
            Historial
          </button>
        </div>
      </div>
      </div>

      <!-- Tarjeta -->
      <div id="cardDisplay" class="card-display rounded-3 mx-3 my-4"></div>
      <p id="lastNumber" class="text-center text-muted small mb-3"></p>

      <!-- Slide Action -->
      <div  id="slideAction"  class="slide-action bg-primary text-white p-3 mx-3 mb-3 rounded-3 d-flex justify-content-between" style="display: none !important;">
        <span>Desliza para guardar</span>
        <span><i class="bi bi-chevron-double-right"></i></span>
      </div>

      <!-- Botón Reiniciar -->
      <button id="resetBtn" class="btn btn-link text-danger w-100 py-2 mb-2">
        Reiniciar Progreso
      </button>
    </div>

    <!-- Modal Historial -->
    <div class="modal fade history-modal" id="historyModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal_historial modal-content overflow-hidden">
          <div class="modal-header border-0">
            <h5 class="modal-title">Historial de Ahorros</h5>
            <button type="button"  class="btn-close btn-close-white"  data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body p-0">
            <div id="historyList" class="px-3"></div>
          </div>
          <div class="area_boton_historial">
            <button class="boton_historial btn-primary rounded-0 py-3" data-bs-dismiss="modal">
              Cerrar Historial
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Confirmación Reinicio -->
    <div class="modal fade" id="confirmModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Confirmar Reinicio</h5>
            <button  type="button" class="btn-close"  data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            ¿Estás seguro que deseas reiniciar tu progreso? Todos tus datos se
            perderán.
          </div>
          <div class="modal-footer">
            <button  type="button"  class="btn btn-secondary"  data-bs-dismiss="modal" >
              Cancelar
            </button>
            <button id="confirmReset" type="button" class="btn btn-danger">
              Reiniciar
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap 5.3.3 JS Bundle con Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Elementos del DOM
        const currentDateEl = document.getElementById("currentDate");
        const progressTextEl = document.getElementById("progressText");
        const remainingTextEl = document.getElementById("remainingText");
        const progressBarEl = document.getElementById("progressBar");
        const totalSavingsEl = document.getElementById("totalSavings");
        const drawCardBtn = document.getElementById("drawCard");
        const showHistoryBtn = document.getElementById("showHistory");
        const cardDisplayEl = document.getElementById("cardDisplay");
        const lastNumberEl = document.getElementById("lastNumber");
        const slideActionBtn = document.getElementById("slideAction");
        const resetBtn = document.getElementById("resetBtn");
        const historyListEl = document.getElementById("historyList");
        const confirmResetBtn = document.getElementById("confirmReset");

        // Lógica para ocultar splash 
    window.addEventListener('load', () => {
      setTimeout(() => {
        document.body.classList.add('loaded');
      }, 2500);
    });

        // Modales de Bootstrap
        const historyModal = new bootstrap.Modal("#historyModal");
        const confirmModal = new bootstrap.Modal("#confirmModal");

        // Datos de la aplicación
        const cards = Array.from({ length: 365 }, (_, i) => i + 1);
        let remainingCards = [...cards];
        let drawnCards = JSON.parse(localStorage.getItem("drawnCards")) || [];

        // Inicializar aplicación
        updateDate();
        updateProgress();
        updateTotalSavings();

        // Event Listeners
        drawCardBtn.addEventListener("click", drawCard);
        slideActionBtn.addEventListener("click", drawCard);
        showHistoryBtn.addEventListener("click", showHistory);
        resetBtn.addEventListener("click", () => confirmModal.show());
        confirmResetBtn.addEventListener("click", resetProgress);

        // Funciones
        function updateDate() {
          const today = new Date();
          currentDateEl.textContent = `Hoy: ${today.getDate()}/${
            today.getMonth() + 1
          }/${today.getFullYear()}`;
        }

        function updateProgress() {
          const drawnCount = drawnCards.length;
          const remainingCount = cards.length - drawnCount;
          const progressPercent = (drawnCount / cards.length) * 100;

          progressTextEl.textContent = `${drawnCount} de ${cards.length} días`;
          remainingTextEl.textContent = `Quedan ${remainingCount}`;
          progressBarEl.style.width = `${progressPercent}%`;
        }

        function updateTotalSavings() {
          const total = drawnCards.reduce((sum, num) => sum + num, 0);
          totalSavingsEl.textContent = `$${total.toLocaleString()}`;
        }

        function drawCard() {
          if (remainingCards.length === 0) {
            cardDisplayEl.textContent = "¡Reto completado!";
            cardDisplayEl.classList.add("bg-primary", "text-white");
            return;
          }

          // Seleccionar número aleatorio
          const randomIndex = Math.floor(Math.random() * remainingCards.length);
          const drawnNumber = remainingCards[randomIndex];

          // Animación
          cardDisplayEl.style.transform = "scale(0.9)";
          setTimeout(() => {
            cardDisplayEl.textContent = `$${drawnNumber}`;
            cardDisplayEl.style.transform = "scale(1)";
          }, 200);

          // Actualizar datos
          drawnCards.push(drawnNumber);
          remainingCards = remainingCards.filter((n) => n !== drawnNumber);
          lastNumberEl.textContent = `Último número: ${drawnNumber}`;

          // Guardar y actualizar UI
          saveProgress();
          updateProgress();
          updateTotalSavings();
        }

        function showHistory() {
          historyListEl.innerHTML = "";

          if (drawnCards.length === 0) {
            historyListEl.innerHTML =
              '<div class="py-3 text-center text-muted">No hay historial disponible</div>';
          } else {
            drawnCards.forEach((num, idx) => {
              const item = document.createElement("div");
              item.className = "history-item d-flex justify-content-between";
              item.innerHTML = `
                            <span>Día ${idx + 1}</span>
                            <span class="fw-bold">$${num}</span>
                        `;
              historyListEl.appendChild(item);
            });
          }

          historyModal.show();
        }

        function resetProgress() {
          drawnCards = [];
          remainingCards = [...cards];
          cardDisplayEl.textContent = "";
          cardDisplayEl.classList.remove("bg-primary", "text-white");
          lastNumberEl.textContent = "";

          saveProgress();
          updateProgress();
          updateTotalSavings();

          confirmModal.hide();
        }

        function saveProgress() {
          localStorage.setItem("drawnCards", JSON.stringify(drawnCards));
        }
      });
    </script>
  </body>
</html>
